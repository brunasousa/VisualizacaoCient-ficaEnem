<!DOCTYPE html>
    <html>
        <head>
        	<meta charset="UTF-8">
			<title>Análise de Dados - Enem 2009-2012</title>
			<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/dc/1.7.5/dc.css">
			
    		<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    		<script src="js/crossfilter.js" charset="utf-8"></script>
   			<script src="js/dc.js" charset="utf-8"></script>
        </head>
        <body>
        	<div id='age-chart'>
			      <h4> Número de inscritos por idade</h4>
			</div>
			<div id='abstention-chart'>
			      <h4> Abstenções</h4>
			</div>


			<script type="text/javascript">
				var ageChart = dc.seriesChart('#age-chart');
				var abstentionChart = dc.lineChart('#abstention-chart');

				d3.json("hello.json", function (data) {

					data.forEach(function (d) {
				        d.idade = +d.idade; 
				        d.sum = +d.sum;
				        d.ano = +d.ano;

				        if(d.status_redacao == "F")
				        	d.abstencao = 1;
				        else
				        	d.abstencao = 0;
				    });

					var facts = crossfilter(data);

					var ageYear = facts.dimension(function(d) {return [d.ano, d.idade]; });
  					var sumAgeGroup = ageYear.group().reduceSum(function(d) { return d.sum; });

  					var yearDim = facts.dimension(function(d) {return [d.ano]; });

  					var sumAbstByYearGroup = yearDim.group().reduceSum(function(d) {
  						 if(d.status_redacao == "F") return d.sum;
  						 else return 0; 
  					});

  					var sumTotalByYearGroup = yearDim.group().reduceSum(function(d) {
  						 return d.sum;
  					});

              		ageChart
					    .width(600)
					    .height(480)
					    .chart(function(c) { return dc.lineChart(c).interpolate('basis'); })
					    .x(d3.scale.linear().domain([13,80]))
					    .brushOn(false)
					    .yAxisLabel("Quantidade de Inscritos")
					    .xAxisLabel("Idade")
					    .clipPadding(10)
					    .elasticY(true)
					    .dimension(ageYear)
					    .group(sumAgeGroup)
					    .mouseZoomable(true)
					    .seriesAccessor(function(d) {return d.key[0];})
					    .keyAccessor(function(d) {return d.key[1];})
					    .valueAccessor(function(d) {return d.value})
					    .legend(dc.legend().x(500).y(150).itemHeight(13).gap(5).horizontal(0).legendWidth(200).itemWidth(70));
					  
					  //ageChart.yAxis().tickFormat(function(d) {return d3.format(',d')(d+299500);});
					  ageChart.margins().left += 40;


					abstentionChart
					    .width(600)
					    .height(480)
					    .x(d3.time.scale().domain(d3.extent(data, function(d){ return d.ano; })))
					    //.interpolate('step-before')
					    .renderArea(true)
					    .yAxisLabel("Quantidade de Abstenções")
					    .xAxisLabel("Ano")
					    .renderDataPoints(true)
					    .clipPadding(10)
					    .dimension(yearDim)
					    .group(sumAbstByYearGroup);


					abstentionChart.xAxis().tickFormat(d3.format("d"));
					abstentionChart.margins().left += 40;
        			
        			dc.renderAll();

				});

			</script>

        </body>
</html>