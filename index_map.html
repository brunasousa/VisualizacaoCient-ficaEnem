<!DOCTYPE html>
    <html>
        <head>
        	<meta charset="UTF-8">
			<title>Análise de Dados - Enem 2009-2012</title>
			<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/dc/1.7.5/dc.css">
			
    		<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    		<script src="js/crossfilter.js" charset="utf-8"></script>
   			<script src="js/dc.js" charset="utf-8"></script>
        </head>
        <body>
        	<div id='brazil-chart'>
			      <h4> Mapa</h4>
			</div>
			<div id='age-chart'>
			      <h4> Número de inscritos por idade</h4>
			</div>

			<script type="text/javascript">

				var brChart = dc.geoChoroplethChart("#brazil-chart");
				var ageChart = dc.seriesChart('#age-chart');
				d3.json("hello.json", function (data) {

					data.forEach(function (d) {
				        d.idade = +d.idade; 
				        d.sum = +d.sum;
				        d.ano = +d.ano;
				    });
					
					var facts = crossfilter(data);

					var ufDim = facts.dimension(function(d) {return d.uf; });
					var sumUfGroup = ufDim.group().reduceSum(function(d) { return d.sum; });

					var ageYear = facts.dimension(function(d) {return [d.ano, d.idade]; });
  					var sumAgeGroup = ageYear.group().reduceSum(function(d) { return d.sum; });

  					var projection = d3.geo.mercator()
						.center([-40,-10])
						.scale(500)
						.rotate([-12,0]);

					d3.json("brazil_geo.json", function (error, statesJson) {
						console.log('map', error);
			            brChart.width(800)
			                    .height(900)
			                    .dimension(ufDim)
			                    .group(sumUfGroup)
			                    .colors(d3.scale.quantize().range(["#E2F2FF", "#C4E4FF", "#9ED2FF", "#81C5FF", "#6BBAFF", "#51AEFF", "#36A2FF", "#1E96FF", "#0089FF", "#0061B5"]))
			                    .colorDomain([0, 3093498])
			                    .projection(projection)
			                    .colorCalculator(function (d) { return d ? brChart.colors()(d) : '#ccc'; })
			                    .overlayGeoJson(statesJson.features, "estados", function (d) {
			                        return d.properties.sigla;
			                    });

			            brChart.legend(dc.legend().x(400).y(10).itemHeight(13).gap(5))


			        	ageChart
							    .width(600)
							    .height(480)
							    .chart(function(c) { return dc.lineChart(c).interpolate('basis'); })
							    .x(d3.scale.linear().domain([13,80]))
							    .brushOn(false)
							    .yAxisLabel("Quantidade de Inscritos")
							    .xAxisLabel("Idade")
							    .clipPadding(10)
							    .elasticY(true)
							    .dimension(ageYear)
							    .group(sumAgeGroup)
							    .mouseZoomable(true)
							    .seriesAccessor(function(d) {return d.key[0];})
							    .keyAccessor(function(d) {return d.key[1];})
							    .valueAccessor(function(d) {return d.value})
							    .legend(dc.legend().x(500).y(150).itemHeight(13).gap(5).horizontal(0).legendWidth(200).itemWidth(70));
							  
							  //ageChart.yAxis().tickFormat(function(d) {return d3.format(',d')(d+299500);});
						ageChart.margins().left += 40;

	        		dc.renderAll();

	        	});
			});

			</script>

        </body>
</html>